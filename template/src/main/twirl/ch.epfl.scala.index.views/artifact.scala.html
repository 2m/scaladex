@import ch.epfl.scala.index.model.Project
@import ch.epfl.scala.index.model.Artifact
@import ch.epfl.scala.index.model.SemanticVersion
@import ch.epfl.scala.index.model.Release
@import ch.epfl.scala.index.model.Dependency
@import ch.epfl.scala.index.model.JavaDependency
@import ch.epfl.scala.index.model.ScalaDependency
@import ch.epfl.scala.index.model.misc.UserInfo
@(project: Project, artifact: Artifact.Reference, version: Option[SemanticVersion], latestStableReleaseOrSelect: List[Release], user: Option[UserInfo])

@staticJs = {
  <script type="text/javascript">

    $(document).ready(function() {

      $("a.targets").on("click", function() {

        $('.targets a.btn').removeClass('btn-primary').addClass('btn-default');
        $(this).addClass('btn-primary').removeClass('btn-default');
      });
    });
  </script>
}

@* reusable code block for dependency listing *@
@dependencyBlock[D <: Dependency](dependencies: Seq[D]) = {
  <ul>
  @for(dependency <- dependencies){
    <li>
      <a href="@dependency.dependency.httpUrl" target="_blank">
        @dependency.dependency.name
      </a>
      v@{dependency match {
          case java: JavaDependency => java.dependency.version
          case scala: ScalaDependency => scala.dependency.version.toString
        }}
      <span class="label label-primary">@dependency.scope</span>
    </li>
  }
  </ul>
}

@main(title = artifact.name, showSearch = true, searchQuery = "", user, Some(staticJs)) {
  <main id="container-project">

    @headproject(project, artifact, version)

    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <div class="content-project box">
            @Html(project.github.flatMap(_.readme).getOrElse(""))
          </div>
        </div>
        <div class="col-md-4">
          <div class="sidebar-project">

            <!-- Statistic -->
            <!--div class="statistic box">
              <h4>Statistic</h4>
              <div class="row">
                <div class="col-md-6 col-sm-6">
                  <ul>
                    <li><a href="#"><i class="fa fa-eye"></i>384 watchers</a></li>
                    <li><a href="#"><i class="fa fa-star"></i>417 Stars</a></li>
                    <li><a href="#"><i class="fa fa-history"></i>396 Commits</a></li>
                    <li><a href="#"><i class="fa fa-tag"></i>13 Releases</a></li>
                  </ul>
                </div>
                <div class="col-md-6 col-sm-6">
                  <ul>
                    <li><a href="#"><i class="fa fa-users"></i>8 Contributors</a></li>
                    <li><a href="#"><i class="fa fa-code-fork"></i>27 Forks</a></li>
                    <li><a href="#"><i class="fa fa-exclamation-circle"></i>19 Open issues</a></li>
                    <li><a href="#"><i class="fa fa-sitemap"></i>8 Dependents</a></li>
                  </ul>
                </div>
              </div>
            </div-->

            <!-- Collaborators -->
            <!--div class="collaborators box">
              <h4>Collaborators</h4>

              <ul>
                <li>
                  <a href="#"><img data-toggle="tooltip" data-placement="bottom" title="Nick Elsberry" src="/assets/img/avatar01.jpg" alt=""></a>
                </li>
                <li>
                  <a href="#"><img data-toggle="tooltip" data-placement="bottom" title="Raul Raja" src="/assets/img/avatar02.jpg" alt=""></a>
                </li>
                <li>
                  <a href="#"><img data-toggle="tooltip" data-placement="bottom" title="Heather Miller" src="/assets/img/avatar03.jpg" alt=""></a>
                </li>
                <li>
                  <a href="#"><img data-toggle="tooltip" data-placement="bottom" title="Javi Pacheco" src="/assets/img/avatar04.jpg" alt=""></a>
                </li>
                <li>
                  <a href="#"><img data-toggle="tooltip" data-placement="bottom" title="Jorge Galindo" src="/assets/img/avatar05.jpg" alt=""></a>
                </li>
                <li>
                  <a href="#"><img data-toggle="tooltip" data-placement="bottom" title="Nora Dhal" src="/assets/img/avatar06.jpg" alt=""></a>
                </li>
                <li>
                  <a href="#"><img data-toggle="tooltip" data-placement="bottom" title="Melisa Aron" src="/assets/img/avatar07.jpg" alt=""></a>
                </li>
              </ul>
            </div-->

            <div class="targets box">
              <h4>Targets</h4>

              @for((release, index) <- latestStableReleaseOrSelect.sortBy(_.reference.targets.orderName).zipWithIndex) {
                <a href="#target-@release.reference.targets.orderName" data-target="#target-@release.reference.targets.orderName" class="targets btn btn-xs @if(0 == index) {btn-primary} else {btn-default}" name="@release.reference.targets.name" role="button" data-toggle="tab"aria-controls="target-@release.reference.targets.orderName">
                    @release.reference.targets.name
                </a>
              }

            </div>

            <div id="#targets" class="tab-content">
              @for((release, index) <- latestStableReleaseOrSelect.sortBy(_.reference.targets.orderName).zipWithIndex) {
                <div id="target-@release.reference.targets.orderName" class="tab-pane fade @if(0 == index) {in active}">

                  <div class="install">
                    <ul class="nav nav-tabs" role="tablist">
                      <li role="presentation" class="active"><a href="#sbt" aria-controls="sbt" role="tab" data-toggle="tab">Sbt</a></li>
                      <li role="presentation"><a href="#maven" aria-controls="maven" role="tab" data-toggle="tab">Maven</a></li>
                      <li role="presentation"><a href="#gradle" aria-controls="gradle" role="tab" data-toggle="tab">Gradle</a></li>
                    </ul>
                    <div class="tab-content">
                      <div role="tabpanel" class="tab-pane active" id="sbt">
                        <pre>@release.sbtInstall</pre>
                      </div>
                      <div role="tabpanel" class="tab-pane" id="maven">
                        <pre>@release.mavenInstall</pre>
                      </div>
                      <div role="tabpanel" class="tab-pane" id="gradle">
                        <pre>@release.gradleInstall</pre>
                      </div>
                    </div>
                  </div>


                  <div class="documentation box">
                    <h4>Documentation</h4>
                    <ul>
                      @for(scaladoc <- release.scalaDocURI){
                        <li><a href="@scaladoc" target="_blank">Scaladoc</a></li>
                      }
                    </ul>
                  </div>


                  <div class="license box">
                    <h4>License</h4>
                    <ul>
                      @for(license <- release.licenses) {
                        <li><a href='@license.url.getOrElse("#")'>@license.shortName</a></li>
                      }
                    </ul>
                  </div>

                  <div class="dependencies box">

                    <h4>@release.dependencyCount Dependencies</h4>
                    @dependencyBlock(release.orderedDependencies)

                    @if(release.javaDependencies.nonEmpty) {

                      <h5>Java Dependencies</h5>
                      @dependencyBlock(release.orderedJavaDependencies)
                    }
                  </div>

                  <div class="dependents box">

                    <h4>@release.uniqueOrderedReverseDependencies.size Dependents</h4>
                    <ul>
                    @for(dependency <- release.uniqueOrderedReverseDependencies){
                      <li>
                        <a href="@dependency.dependency.httpUrl" target="_blank">
                        @dependency.dependency.name
                        </a>
                        <span class="label label-primary">@dependency.scope</span>
                        <div class="versions">
                          @release.versionsForReverseDependencies(dependency).map(version => s"v${version.toString}").mkString(", ")
                        </div>
                      </li>
                    }
                    </ul>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
}